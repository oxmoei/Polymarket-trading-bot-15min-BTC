# 功能指南

[English](FEATURES.md) | [中文说明](FEATURES-CN.md)

本指南介绍 BTC 15 分钟套利机器人的全部功能。

## 🎯 核心功能

### 自动发现市场
- **作用**：自动识别并连接当前 BTC 15 分钟市场
- **原理**：扫描 Polymarket 中符合命名规则的市场
- **切换时机**：当前市场关闭后自动切换
- **无需配置**：默认自动生效

### 套利检测
- **作用**：持续扫描套利机会
- **原理**：监控 UP 和 DOWN 价格，检测总成本 < $1.00
- **实时数据**：使用订单簿实时数据（非历史成交价）
- **智能定价**：使用深度感知价格确保可成交

### 执行安全
- **作用**：确保 UP + DOWN 双边都成交
- **原理**：确认双边订单都完成后才记录成交
- **回退策略**：若一侧失败，尝试平仓
- **保护机制**：降低单边成交风险

### 模拟模式
- **作用**：无需真实资金即可测试
- **原理**：完整运行逻辑但不提交真实订单
- **跟踪**：统计模拟余额与利润
- **安全学习**：适合入门与策略测试

---

## 📊 统计与跟踪

### 交易历史
- **自动记录**：所有交易自动记录到 JSON 文件
- **持久存储**：重启后历史仍保留
- **导出选项**：支持导出 CSV 便于分析
- **数据丰富**：包含价格、规模、利润、时间戳等

### 绩效指标
- **胜率**：盈利交易占比
- **平均利润**：每笔交易平均收益
- **总统计**：交易次数、投入、利润
- **实时更新**：每次交易后更新统计

### 使用示例

```python
# 统计默认启用
# 在市场结束后的最终总结中查看

# 导出 CSV：
from src.statistics import StatisticsTracker
tracker = StatisticsTracker(log_file="trades.json")
tracker.export_csv("trades.csv")
```

---

## 🛡️ 风险管理

### 每日亏损限制
- **作用**：达到每日最大亏损后停止交易
- **使用方式**：设置 `MAX_DAILY_LOSS=50.0`（亏损达 $50 停止）
- **每日重置**：在午夜重置
- **安全保障**：防止糟糕交易日造成过大损失

### 单笔持仓限制
- **作用**：限制单笔交易最大规模
- **使用方式**：设置 `MAX_POSITION_SIZE=100.0`（单笔最多 $100）
- **资金保护**：避免过大仓位
- **灵活调整**：按风险承受能力设置

### 交易频率限制
- **作用**：限制每日交易次数
- **使用方式**：设置 `MAX_TRADES_PER_DAY=20`（每天最多 20 次）
- **避免过度交易**：减少情绪化操作
- **控制成本**：降低频繁交易成本

### 资金利用率
- **作用**：限制单笔交易使用的余额比例
- **使用方式**：设置 `MAX_BALANCE_UTILIZATION=0.8`（最多使用 80%）
- **安全缓冲**：保留部分余额应对意外
- **推荐值**：0.7-0.8（70-80%）

### 最低余额限制
- **作用**：余额低于阈值时停止交易
- **使用方式**：设置 `MIN_BALANCE_REQUIRED=10.0`
- **避免枯竭**：在资金耗尽前停止
- **安全垫**：保留应急资金

---

## 🎨 增强日志与界面

### Rich 控制台输出
- **作用**：更美观的彩色输出
- **特性**：表格、颜色、进度提示
- **可选**：未启用时自动退回基础输出
- **安装**：`poetry install`（rich 已包含在依赖中）

### 进度与状态提示
- **实时更新**：实时显示机器人活动
- **清晰排版**：易于阅读的状态信息
- **错误高亮**：错误信息更醒目
- **统计展示**：以表格形式显示统计数据

---

## ⚙️ 高级功能

### WebSocket 模式
- **作用**：更低延迟的市场数据
- **使用方式**：在 `.env` 中设置 `USE_WSS=true`
- **优势**：更快的执行与实时更新
- **要求**：稳定网络连接
- **推荐**：适合有经验用户

### 配置验证
- **作用**：启动前检查配置
- **原理**：验证所有设置并报告错误
- **收益**：减少配置错误导致的运行失败
- **自动**：启动时自动执行

### 优雅停机
- **作用**：优雅退出并保存数据
- **原理**：处理 Ctrl+C 退出
- **收益**：保存统计并展示总结
- **无数据丢失**：交易历史得以保留

---

## 🔄 市场管理

### 自动市场切换
- **作用**：当前市场关闭后自动切换下一个
- **原理**：每 15 分钟扫描新市场
- **无缝衔接**：无需手动操作
- **稳定可靠**：处理市场切换流程

### 市场结果跟踪
- **作用**：记录每个市场的胜方（UP/DOWN）
- **原理**：市场关闭后检测最终价格
- **集成记录**：写入交易记录
- **分析支持**：支持按结果分析表现

---

## 📈 性能相关功能

### 深度感知定价
- **作用**：使用订单簿深度计算真实成交价
- **原理**：遍历订单簿确保流动性
- **更准确**：优于只用最优买卖价
- **更安全**：确保订单可成交

### 并发获取订单簿
- **作用**：同时获取 UP/DOWN 订单簿
- **优势**：更快扫描、更低延迟
- **效率**：减少扫描周期
- **自动**：默认启用

### 冷却机制
- **作用**：避免对同一机会频繁交易
- **配置**：设置 `COOLDOWN_SECONDS=10`
- **收益**：避免重复交易、降低手续费
- **灵活**：可按市场情况调整

---

## 🧪 测试与开发

### 模拟模式
- **完整模拟**：执行全部逻辑但不下真实订单
- **真实数据**：使用实时市场数据
- **安全**：适合测试策略
- **跟踪**：完整统计与记录

### 详细日志
- **作用**：输出详细调试信息
- **启用方式**：设置 `VERBOSE=true`
- **使用场景**：调试、开发、排查问题
- **输出**：详细的操作日志

### 余额测试
- **工具**：`poetry run python -m src.test_balance`
- **作用**：验证钱包连接和余额
- **用途**：检查配置、确认资金
- **安全**：只读，不下单

---

## 📋 功能对比

| 功能 | 基础版 | 增强版 |
|---------|-----------|--------------|
| 套利检测 | ✅ | ✅ |
| 自动发现市场 | ✅ | ✅ |
| 模拟模式 | ✅ | ✅ |
| 统计跟踪 | ❌ | ✅ |
| 风险管理 | ❌ | ✅ |
| 交易历史导出 | ❌ | ✅ |
| Rich 控制台输出 | ❌ | ✅ |
| 配置验证 | ❌ | ✅ |
| 优雅停机 | ❌ | ✅ |

---

## 💡 如何高效使用功能

### 新手建议
1. 使用 **模拟模式** 学习流程
2. 先采用 **默认配置**
3. 启用 **统计跟踪** 观察表现
4. 设置 **保守的风险限制**
5. 定期查看 **交易历史**

### 进阶用户建议
1. 使用 **风险管理** 保护资金
2. 启用 **WebSocket** 降低延迟
3. 分析 **统计数据** 优化参数
4. 导出 **交易历史** 做深入分析
5. 根据市场情况调整 **冷却时间**

### 高级用户建议
1. 根据策略微调 **风险限制**
2. 启用 **详细日志** 进行调试
3. 深入分析 **绩效指标**
4. 优化 **ORDER_SIZE** 与 **TARGET_PAIR_COST**
5. 手动配置以监控 **多个市场**

---

## 🔗 相关文档

- [GETTING_STARTED-CN.md](GETTING_STARTED-CN.md) - 快速入门
- [CONFIGURATION-CN.md](CONFIGURATION-CN.md) - 配置说明
- [TROUBLESHOOTING-CN.md](TROUBLESHOOTING-CN.md) - 故障排除

---

**需要帮助？** 请联系 Telegram：[@terauss](https://t.me/terauss)

